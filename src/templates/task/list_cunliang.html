{% extends "base.html" %}
{% include "baseuser.html" %}

{% block content %} 
<div class="container-fluid" align="center">
	<style>
	.predestalView{
		background-color:white;
		height:620px;
		width:90%;
		margin-left:0px;
		margin-top:-15px;
		padding-top:5px;
		padding-left:2%;
		border-bottom-right-radius: 20px;
		border-bottom-left-radius: 20px;
	}
	
	h3{
		height:50px;
		background-color:white;
		margin-top:-5px;
		padding-top:10px;
		border-top-right-radius: 20px;
		border-top-left-radius: 20px;
		color: #007AFF;
	}
	
	.hege_list > h4{
  		text-align:center;
  		font-weight:bold;
  		color:#60C560;
	}
	
	.content_list > h4{
		text-align:center;
		font-weight:bold;
  		color:#007AFF;
	}
	
	.span3{
		width:20%;
		display:inline-block;
	}
	
	.col-sm-6{
		width:100%;
	}
	
	.col-sm-6 > label{
		font-size:20px;
		width:60%; 
		height:30px;
		color:black; 
		text-align: center;
	}
	
	.row-fluid{
		width:99%;
		height:40px;
		margin-top:2%;
		text-align:center
	}
	
	.viewTai{
		height:100px;
		padding-right:5%;
	}
	
	.yuzhitai_title{
		height: 90%;
		width:20%;
		margin-top:5%;
		margin-left:30%;
		display:inline-block;
		vertical-align: top;
		text-align: center;
	}
	
	.yuzhitai_title >  h4{	
		width:100%;
		font-size:20px;
		font-style: italic;
		font-weight: bold;
		text-align:center;
		display:inline-block;
	}
	
	.listArea{
		width:5.5%;
		height:90%;
		margin-right:2px;
		display: inline-block;
		vertical-align: middle;
	}
	
	.listArea > div > label{
		font-size:20px; 
		width:100%; 
		padding-top:1%;
		font-weight: bold;
		text-align:center;
		color:black;
	}
	
	.paintView_hege{
			background-color:#6AEC87;
			color:black
		}
	.paintView_cunfang{
			background-color:#FCD209;
			color:black
		}	
	.paintView_weiqiyong{
			background-color:#A2B5CD;
			color:black
		}	
	.paintView_yichang{
			background-color:red;
			color:black
		}	
	
	</style>
	<div>
	<h3 align="center" style="width: 90%;"><i class="glyphicon glyphicon-th-list"></i>存梁区状态图</h3>
	
	<div class="predestalView">
		{% for item in list_items %}
			{% ifequal forloop.counter 1%}
				<div class="viewTai" align="left">   
			{% endifequal %}
			{% ifequal forloop.counter 7%}
				<div class="viewTai" align="left">   
			{% endifequal %}
			{% ifequal forloop.counter 13%}
				<div class="viewTai" align="left">   
			{% endifequal %}
			{% ifequal forloop.counter 21%}
				<div class="viewTai" align="left" style="padding-left:5%;">   
			{% endifequal %}
			{% ifequal forloop.counter 37%}
				<div class="viewTai" align="left" style="padding-left:5%; ">   
			{% endifequal %}
   
		  		<div class="listArea" style="display:inline-block;" onclick="showList('{{item.name}}',{{item.num}})">									
						{% if item.num > 10 %}
							<div class="paintView_cunfang" style="height:15%; width:80%;  text-align:center; margin:0px auto;margin-top:20%;border-bottom:0;">	
							</div>
							<div class="paintView_cunfang" style="height:25%; width:100%;  text-align:center;  margin:0px auto;" >
								<label id='{{item.name}}' >{{item.num}}</label>
							</div>
							<div class="paintView_cunfang" style="height:20%; width:80%;  text-align:center; margin:0px auto;">	
							</div>
							
						{% elif item.num < 10 and item.num %}	
							<div class="paintView_hege" style="height:15%; width:80%;  text-align:center; margin:0px auto;margin-top:20%;border-bottom:0;">	
							</div>
							<div class="paintView_hege" style="height:25%; width:100%;  text-align:center;  margin:0px auto;" >
								<label id='{{item.name}}'>{{item.num}}</label>
							</div>
							<div class="paintView_hege" style="height:20%; width:80%;  text-align:center; margin:0px auto;">	
							</div>
									
						{% else %}	
							<div class="paintView_weiqiyong" style="height:15%; width:80%;  text-align:center; margin:0px auto;margin-top:20%;border-bottom:0;">	
							</div>	
							<div class="paintView_weiqiyong" style="height:25%; width:100%;  text-align:center;  margin:0px auto;" >	
								<label>
									空闲
								</label>
							</div>
							<div class="paintView_weiqiyong" style="height:20%; width:80%;  text-align:center; margin:0px auto;">	
							</div>
						{% endif %}	
					
					<div align="center" style="margin-top:5%;font-weight: bold;font-size:20px; color:black">{{item.name}}</div>						
				</div>	
			{% if forloop.counter in row_num_list %}	 
				{% ifequal forloop.counter 6%}
					<div class= "yuzhitai_title">
						<h4 >点击台座显示 </h4>
						<h4 >相应梁段信息 </h4>
    					<a href="javascript:PrintPbAll()" class="btn btn-success btn"><i class="fa fa-qrcode"></i>&nbsp&nbsp打印存梁区二维码&nbsp&nbsp </a>
						<br>
						<br>
						<div class="input-group">
			               <input type="text" class="form-control" id="keyword" placeholder="查询梁段位置">
			               <span class="input-group-btn">
			                  <button class="btn btn-primary" type="button" onclick= "search($('#keyword').val());">
			                     	查询
			                  </button>
			                  <lable id="search-tip"></label>
			               </span>
			            </div>
					</div>
				{% endifequal %}
				</div>
			{% endif %}
		 {% endfor %}
	</div>
	<div class="row-fluid" >
		<div class="span3">
   			<div class="col-sm-6">			
					<label style="background-color:#6AEC87;" >正常使用</label>
			</div>
		</div>     

		<div class="span3">
			<div class="col-sm-6">			
					<label style="background-color:#FCD209;" >空间紧张</label>
			</div>
		</div>  
		
		<div class="span3">
			<div class="col-sm-6">			
					<label style="background-color:#A2B5CD;" >台座未启用</label>
			</div>
		</div>                
	</div>
     
	<div style="display:none;">
		<a href="javascript:PrintPbAll()" class="btn btn-success btn"><i class="fa fa-qrcode"></i>&nbsp&nbsp打印存梁区二维码&nbsp&nbsp </a>
		<!-- 注释了，需要在打开。潘古兵 -->
		<!-- <a href="javascript:gen_preqrcode()" class="btn" role="button"><i class="icon-print"></i>&nbsp&nbsp生成存梁区二维码&nbsp&nbsp </a> -->
	</div>
	
	
	<div style="margin-top:10%;" class="modal fade" id="liangduan_list" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    	<div class="modal-dialog">
	      <div class="modal-content">
	         <div class="modal-header">
	            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
	                  &times;
	            </button>
	            <h4 class="modal-title" id="myModalLabel" style="font-weight:bold;">
	            	梁段信息列表
	            </h4>
	         </div>
	         <div class="modal-body" align="center">
	         	<div style="width:45%; display:inline-block;vertical-align:top;">
	         		<h4 style="color:#007AFF;font-weight:bold;">暂时存放</h4>
	         		<div class="content_list">
	         			<h4>loading</h4>
	         		</div>
	         	</div>
	         
	         	<div style="width:45%; display:inline-block; vertical-align:top;">
	         		<h4 style="color: #60C560;font-weight:bold;">出厂检查合格</h4>
	         		<div class="hege_list">
	         			<h4>loading</h4>
	         		</div>
	         	</div>
	         	
	         	
	         </div>
	      </div>
   		</div>
   	</div>

</div>
<script src="/js/yuzhitai.js" type="text/javascript"></script>
<script type="text/javascript" language="javascript"> 
	function PrintPbAll()
	{
		var dwidth=window.screen.width;
		var dheight=window.screen.height;
        //var dlgResult = window.showModalDialog("/task/cunliangqu/printcunliang/", window, "dialogWidth:"+dwidth+"px;dialogHeight:"+dheight+"px; status:0");
		if(window.ActiveXObject)
		{ //IE  
			 var dlgResult = window.showModalDialog("/task/cunliangqu/printcunliangqu/", window, "dialogWidth:"+dwidth+"px;dialogHeight:"+dheight+"px; status:0"); 
		}
		else
		{  //非IE  
			window.open("/task/cunliangqu/printcunliangqu/", 'newwindow','height='+dheight+',width='+dwidth+',toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no');  
		} 	
	}
	
	function gen_preqrcode()
	{
		var xmlhttp;
		if (window.XMLHttpRequest)
		{// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp=new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
		  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function()
		{
		  if (xmlhttp.readyState==4 && xmlhttp.status==200)
		  {
			var result=xmlhttp.responseText;
			alert(result);
		  }
		}
		xmlhttp.open("GET","/task/predestal/gen_preqrcode/",true);
		xmlhttp.send();
	}
	
	function search(keyword){
		$.ajax({
		  type:"post",
		  url:"search_cunliangqu/",
		  cache:false,
		  dataType:"json",
		  data:{"keyword": keyword},
		  success: function(data){
		  	if(data.status=="Succeed"){
		  		$(".listArea > div > label").each(function(){
		  			if(data.result_list.indexOf($(this).attr('id')) >= 0){
						var bool = $(this).html().indexOf(keyword);
						$(this).attr({style:"text-decoration:underline;color:red;"});
					}
					else{
						$(this).attr({style:"text-decoration:none;color:black;"});
					}
				});
				
				if(data.count > 0){
					$("#search-tip").html(data.count.toString() + "个满足条件");
				}
				else{
					$("#search-tip").html("没有满足条件.");
				}
		  	}
		  },
		  error:function(data){
		  	alert("服务器错误");
	      	return false;
	      },
	      complete:function(data){
		  }
		});
	}
	
	function refreshModal(name){
		$(".content_list").html("<h4>loading</h4>");
		$(".hege_list").html("<h4>loading</h4>");
		$.ajax({
		  type:"post",
		  url:"query_cunliangqu/",
		  cache:false,
		  dataType:"json",
		  data:{"name": name},
		  success: function(data){
		  	if(data.status=="Succeed"){
		  		html = "";	  		  		
		  		for(index in data.cunliang_list){
		  			html += "<h4>" + data.cunliang_list[index] + "</h4>";	
		  		}
		  		
		  		for(index in data.error_list){
		  			html += "<h4 style='color:red;'>" + data.error_list[index] + "</h4>";	
		  		}
		  		
		  		if(html){
		  			$(".content_list").html(html);
		  		}
		  		else{
		  			$(".content_list").html("<h4>没有记录</h4>");
		  		}
		  		
		  		html = "";	  		  		
		  		for(index in data.hege_list){
		  			html += "<h4>" + data.hege_list[index] + "</h4>";	
		  		}

		  		if(html){
		  			$(".hege_list").html(html);
		  		}
		  		else{
		  			$(".hege_list").html("<h4>没有记录</h4>");
		  		}
		  	}
		  	return true;
		  },
		  error:function(data){
		  	alert("服务器错误");
	      	return false;
	      },
	      complete:function(data){
			}
		});
	}
	
	function showList(name, num){
		if(num){
			refreshModal(name);
			$('#liangduan_list').modal('show');
		}
		else{
			alert("空闲状态，无相关梁段.");
		}
	}
</script>
{% endblock %}
